(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b},c=function(a,b){return function(){return a.apply(b,arguments)}},d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("angular-models",["angular-linkto","angular-lifecycle"]),angular.module("angular-models").service("AttributesMixin",function(){return{dependencies:function(){return this._attributes={}},hasAttributes:function(){return null!=this._attributes},set:function(a,b){var c,d,e,f;if(this._isMultilevelString(a))e=a.split(/\./),f=this._crawlObjects(this._attributes,e),("function"==typeof f.hasAttributes?f.hasAttributes():void 0)?f.set(e[e.length-1],b):f[e[e.length-1]]=b;else{_.isObject(a)?d=a:(d={})[a]=b;for(c in d)b=d[c],this._attributes[c]=b}return this},get:function(a){var b,c;return this._isMultilevelString(a)?(b=a.split(/\./),c=this._crawlObjects(this._attributes,b),("function"==typeof c.hasAttributes?c.hasAttributes():void 0)?c.get(b[b.length-1]):c[b[b.length-1]]):this._attributes[a]},clear:function(){return this._attributes={}},getModels:function(a){var b;return(null!=(b=this._attributes[a])?"function"==typeof b.hasModels?b.hasModels():void 0:void 0)?this._attributes[a].models:this.get(a)},toJSON:function(){var a,b,c,d,e,f,g,h,i,j;c={},i=this._attributes;for(b in i)if(d=i[b],_.isArray(d))for(c[b]=[],e=0,g=d.length;g>e;e++)a=d[e],c[b].push(null!=a.toJSON?a.toJSON():a);else if(null!=d?"function"==typeof d.hasModels?d.hasModels():void 0:void 0)for(c[b]=[],j=d.models,f=0,h=j.length;h>f;f++)a=j[f],c[b].push("function"==typeof a.toJSON?a.toJSON():void 0);else c[b]=(null!=d?"function"==typeof d.hasAttributes?d.hasAttributes():void 0:void 0)?"function"==typeof d.toJSON?d.toJSON():void 0:d;return c},_ensureObject:function(a,b){var c;return("function"==typeof a.hasAttributes?a.hasAttributes():void 0)?(c=a.get(b[0]),c||(c=a.set(b[0],{}))):(c=a[b[0]],c||(c=a[b[0]]={})),c},_crawlObjects:function(a,b){return b.length<=1?a:this._crawlObjects(this._ensureObject(a,b),b.slice(1))},_isMultilevelString:function(a){return _.isString(a)&&a.match(/\./)}}}),angular.module("angular-models").factory("Collection",["$rootScope","$http","Module","Model","Lifecycle","UrlMixin","NameMixin",function(a,c,d,e,f,g,h){var i;return i=function(d){function i(a){i.__super__.constructor.apply(this,arguments),this.reset(a)}return b(i,d),i.include(h),i.include(f),i.include(g),i.prototype.model=e,i.prototype.add=function(a){return a&&null==this.get(a)?(("function"==typeof a.hasAttributes?a.hasAttributes():void 0)||(a=new this.model(a)),this.models.push(a),this.length++,a):void 0},i.prototype.remove=function(a){var b;return null!=a&&(b=this.models.indexOf(this.get(a)),b>=0)?(this.models.splice(b,1),this.length--):void 0},i.prototype.push=i.prototype.add,i.prototype.fetch=function(){var b,d,e,f=this;return d=this._getName(),e=function(b){return f.deserialize(b),f.setLifecycle("loaded"),a.$broadcast(""+d+":fetched",f),a.$broadcast(""+d+":fetched:success",f)},b=function(){return f.setLifecycle("error"),a.$broadcast(""+d+":fetched",f),a.$broadcast(""+d+":fetched:error",f)},this.setLifecycle("fetching"),c.get(this._getUrl()).success(e).error(b)},i.prototype.hasModels=function(){return null!=this.models},i.prototype.get=function(a){return _(this.models).find(function(b){var c,d,e;return d=b===a,c=null!=a.id&&null!=b.get("id")&&a.id===b.get("id"),e=("function"==typeof a.hasAttributes?a.hasAttributes():void 0)&&null!=a.get("id")&&null!=b.get("id")&&a.get("id")===b.get("id"),d||c||e})},i.prototype.find=i.prototype.get,i.prototype.reset=function(a){var b,c,d,e,f;if(this.models=[],this.length=0,null!=a){for(c=_.isArray(a)?a:[a],f=[],d=0,e=c.length;e>d;d++)b=c[d],f.push(this.add(b));return f}},i.prototype.deserialize=function(a){return this.reset(a[this._getName()])},i.prototype.eq=function(a){return this.models[a]},i.prototype.at=i.prototype.eq,i.prototype.first=function(){return this.models[0]},i.prototype.last=function(){return this.models[this.models.length-1]},i}(d)}]),angular.module("angular-models").factory("Model",["$rootScope","$http","Module","NameMixin","Lifecycle","AttributesMixin","UrlMixin",function(a,d,e,f,g,h,i){var j;return j=function(e){function j(a){this.destroy=c(this.destroy,this),this.save=c(this.save,this),this.fetch=c(this.fetch,this),j.__super__.constructor.call(this,a),this.errors={},null!=a&&(_.isString(a)?this.url=a:this.set(a))}return b(j,e),j.include(f),j.include(g),j.include(h),j.include(i),j.prototype.fetch=function(){var b,c,e,f,g,h=this;return e=this._getName(),f=function(b){return h.deserialize(b),h.setLifecycle("loaded"),a.$broadcast(""+e+":fetched",h),a.$broadcast(""+e+":fetched:success",h)},b=function(b){return h._saveErrors(b),h.setLifecycle("error"),a.$broadcast(""+e+":fetched",h),a.$broadcast(""+e+":fetched:error",h)},c=(null!=(g=this._getUrl())?g.indexOf("callback=JSON_CALLBACK"):void 0)>-1?"jsonp":"get",this.setLifecycle("fetching"),d[c](this._getUrl()).success(f).error(b)},j.prototype.save=function(){var b,c,e,f,g=this;return e=this._getName(),f=function(b){return g.deserialize(b),g.setLifecycle("loaded"),a.$broadcast(""+e+":saved",g),a.$broadcast(""+e+":saved:success")},b=function(b){return g._saveErrors(b),g.setLifecycle("error"),a.$broadcast(""+e+":saved",g),a.$broadcast(""+e+":saved:error")},c=this.hasId()?"put":"post",this.setLifecycle("saving"),d[c](this._getUrl(),this.serialize()).success(f).error(b)},j.prototype.destroy=function(){var b,c,e,f=this;return c=this._getName(),e=function(b){return f.deserialize(b),f.setLifecycle("deleted"),a.$broadcast(""+c+":destroyed",f),a.$broadcast(""+c+":destroyed:success")},b=function(b){return f._saveErrors(b),f.setLifecycle("error"),a.$broadcast(""+c+":destroyed",f),a.$broadcast(""+c+":destroyed:error")},this.setLifecycle("saving"),d["delete"](this._getUrl()).success(e).error(b)},j.prototype.toJson=j.prototype.toJSON,j.prototype.deserialize=function(a){return this.set(a)},j.prototype.serialize=function(){return this.toJSON()},j.prototype.hasId=function(){return null!=this.get("id")},j.prototype._saveErrors=function(a){return _.extend(this.errors,null!=(null!=a?a.errors:void 0)?a.errors:a)},j}(e)}]),angular.module("angular-models").factory("Module",function(){var a,b;return b=["included","dependencies"],a=function(){function a(){var a,b,c,d;if(null!=this._dependencyFns)for(d=this._dependencyFns,b=0,c=d.length;c>b;b++)a=d[b],a.apply(this)}return a.prototype._dependencyFns=[],a.include=function(a){var c,e,f;for(c in a)e=a[c],d.call(b,c)<0&&(this.prototype[c]=e);return null!=a.dependencies&&this.prototype._dependencyFns.push(a.dependencies),null!=(f=a.included)&&f.apply(this),this},a}()}),angular.module("angular-models").service("NameMixin",function(){return{name:function(){var a,b;return(null!=(a=this.constructor)?null!=(b=a.name)?b.toLowerCase():void 0:void 0)||"model"},_getName:function(){return _.result(this,"name")}}}),angular.module("angular-models").service("UrlMixin",["$filter",function(a){return{dependencies:function(){return null!=this.urlRoot?this.urlRoot:this.urlRoot=""},_getUrl:function(){var b,c;return b=_.result(this,"url"),c=(null!=b?b.indexOf(this.urlRoot):void 0)>-1?b:""+this.urlRoot+b,a("linkTo")(c,this)}}}])}).call(this);